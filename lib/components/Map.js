Object.defineProperty(exports,"__esModule",{value:true});var _jsxFileName='app/components/Map.js';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _react=require('react');var _react2=_interopRequireDefault(_react);var _reactNative=require('react-native');var _reactNativeFirebase=require('react-native-firebase');var _reactNativeFirebase2=_interopRequireDefault(_reactNativeFirebase);var _reactNativeMapboxGl=require('@mapbox/react-native-mapbox-gl');var _reactNativeMapboxGl2=_interopRequireDefault(_reactNativeMapboxGl);var _Globals=require('../Globals.js');var _Globals2=_interopRequireDefault(_Globals);var _reactNativeRouterFlux=require('react-native-router-flux');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var displaysRef=_reactNativeFirebase2.default.database().ref('/'+_Globals2.default.FIREBASE_TBL_DISPLAYS);_reactNativeMapboxGl2.default.setAccessToken(_Globals2.default.MAPBOX_ACCESS_TOKEN);var Map=function(_Component){_inherits(Map,_Component);function Map(props){_classCallCheck(this,Map);var _this=_possibleConstructorReturn(this,(Map.__proto__||Object.getPrototypeOf(Map)).call(this,props));_this.state={displays:[],refreshing:true};return _this;}_createClass(Map,[{key:'componentWillMount',value:function componentWillMount(){this.fetchDisplays();}},{key:'fetchDisplays',value:function fetchDisplays(){var _this2=this;displaysRef.limitToFirst(100).on('value',function(snap){var items=[];snap.forEach(function(child){if(child.val().Images!=null){items.push({title:child.key,description:child.val().Description,starCount:4.6,image:child.val().Images[0],latitude:child.val().Latitude,longitude:child.val().Longitude});console.log('lat: '+child.val().Latitude+' long: '+child.val().Longitude);}});_this2.setState({displays:items,refreshing:false});});}},{key:'render',value:function render(){return _react2.default.createElement(_reactNative.View,{style:styles.container,__source:{fileName:_jsxFileName,lineNumber:70}},_react2.default.createElement(_reactNativeMapboxGl2.default.MapView,{styleURL:_reactNativeMapboxGl2.default.StyleURL.Light,zoomLevel:10,zoomEnabled:true,centerCoordinate:[-118.243683,34.052235],style:styles.mapbox,showUserLocation:true,userTrackingMode:2,__source:{fileName:_jsxFileName,lineNumber:71}},this.renderAnnotations()),_react2.default.createElement(_reactNative.TouchableOpacity,{style:styles.menuIcon,onPress:this.onMenuPressed,__source:{fileName:_jsxFileName,lineNumber:82}},_react2.default.createElement(_reactNative.Image,{source:require('../img/menu_icon.png'),__source:{fileName:_jsxFileName,lineNumber:83}})),_react2.default.createElement(_reactNative.TouchableOpacity,{style:styles.addDisplayIcon,onPress:this.onCreateDisplayPressed,__source:{fileName:_jsxFileName,lineNumber:86}},_react2.default.createElement(_reactNative.Image,{source:require('../img/icon_add_display.png'),__source:{fileName:_jsxFileName,lineNumber:87}})));}},{key:'renderAnnotations',value:function renderAnnotations(){return this.state.displays.map(function(item,i){return _react2.default.createElement(_reactNativeMapboxGl2.default.PointAnnotation,{key:i,id:'pointAnnotation',coordinate:[item.longitude,item.latitude],__source:{fileName:_jsxFileName,lineNumber:115}},_react2.default.createElement(_reactNative.View,{style:styles.annotationContainer,__source:{fileName:_jsxFileName,lineNumber:119}},_react2.default.createElement(_reactNative.View,{style:styles.annotationFill,__source:{fileName:_jsxFileName,lineNumber:120}})),_react2.default.createElement(_reactNativeMapboxGl2.default.Callout,{title:'{item.title}',__source:{fileName:_jsxFileName,lineNumber:122}}));});}},{key:'onMenuPressed',value:function onMenuPressed(){_reactNativeRouterFlux.Actions.drawerOpen();}},{key:'onCreateDisplayPressed',value:function onCreateDisplayPressed(){_reactNativeRouterFlux.Actions.createDisplay();}}]);return Map;}(_react.Component);exports.default=Map;var styles=_reactNative.StyleSheet.create({container:{flex:1},mapbox:{flex:1},menuIcon:{position:'absolute',top:32,left:22},addDisplayIcon:{position:'absolute',bottom:10,right:10},annotationContainer:{width:30,height:30,alignItems:'center',justifyContent:'center',backgroundColor:'white',borderRadius:15},annotationFill:{width:30,height:30,borderRadius:15,backgroundColor:'orange',transform:[{scale:0.6}]}});